<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="css/reset.css">
	<link rel="stylesheet" href="css/spaceInv.css">
	<title>l'invasion de l'espace</title>
	<script type="text/javascript">
nm = 0
m = new Array()
var tm = new Array()
var lastFire = 0

//       Récupére la largeur et la hauteur de la page utile         //
    largeur=screen.availWidth
    hauteur=screen.availHeight
    vaisseau=(largeur/2)-110

//     Redimention de la surface jouable en fonction de la résolution jouable    //

function redim(){
   document.bgColor="black"
   document.getElementById('univers').style.left=(largeur/2)-400 +'px'
   document.getElementById('univers').style.top=(hauteur/2)-300 +'px'

//        Position du vaisseau pour qu'il coincide avec le milieu du bas de la surface jouable    //

   document.getElementById('ship').style.top=(hauteur/2)+100 +'px'
   document.getElementById('ship').style.left=(largeur/2)-50 +'px'
}

function Touche_presse(keyCode){
   switch(keyCode){
        case 37: bouge(0,-15); break; //  fleche gauche pressée code ascii   //
        case 39: bouge(15,0); break;  //  fleche droite pressée code ascii   //
        case 32: tir();break;         //         touche espace               //
        default:break;
}
}

//        Déplacement du vaisseau sur l'axe des abscisses               //
function bouge(x,y){
    min=(largeur/2)-420
    max=(largeur/2)-400+640

      if(vaisseau<max){
         vaisseau+=x

            document.getElementById('ship').style.left=vaisseau +'px'
}

       if(vaisseau>min){
          vaisseau+=y

            document.getElementById('ship').style.left=vaisseau +'px'

}
}

//                    gestion missile                 //

var missiles = [];

const TOUCHE_BAS = 'ArrowDown';
const TOUCHE_HAUT = 'ArrowUp';
const TOUCHE_GAUCHE = 'ArrowLeft'; /*Constantes que retourne la méthode key d'un évènement clavier */
const TOUCHE_DROITE = 'ArrowRight';
const TIRER = 'space';

function Missile(posx, posy, image, scene, target = 0) { /* Constructeur de missiles */
    this.posx = posx;
    this.posy = posy;
    this.scene = scene;
    this.image = image;
    this.target = target;
    tir.play();

    this.dessiner = function () {
        if (!this.target) {
            this.scene.drawImage(this.image, this.posx, this.posy, this.image.width, this.image.height)
        }
    }
    this.effacer = function () {
        this.scene.clearRect(this.posx, this.posy, this.image.width, this.image.height);
    }

if (touche == TIRER) {        
                    missiles.push(new Missile(vaisseau.posx + 22, 490, imageMissile, plateauJeu));
                    missiles[missiles.length - 1].dessiner();
                }

/*
function vassel(x, y, id){
	this.x = x 
	this.y = y
	this.id = id
}*/
/*function armee(){
	this.nVas = 24
	this.vy = 20
	this.Xorig = 185
	this.x0 = 185
	this.y0 = 0
	this.nax = 0
	this.t0 = new Date().getTime()/1000
	this.battle = new Array()
	this.heigh = 300
	for( i = 0 ; i<this.nVas ; i++){
		this.battle[i] = new vassel((i%6)*75, Math.floor(i/6)*60, "vas_"+i) 
	}
	this.draw = function(){
		for( i = 0 ; i<this.nVas ; i++){
			document.getElementById("armee").innerHTML += "<div id='vas_"+i+"' class='vas' style='left:"+this.battle[i].x+"px; top: "+this.battle[i].y+"px'><img src='img/invader.png'/></div>"
		}
	}
	this.run = function() {
		this.nax++
		var now = new Date().getTime()/1000 
		var dt = now-this.t0
		this.x0 = 60*Math.sin(2*3.1416*dt/5)+this.Xorig
		document.getElementById("armee").style.left = this.x0
		this.y0=this.vy*dt
		document.getElementById("armee").style.top = this.y0
		if (a.heigh+a.y0>600){
			alert("Vous avez perdu !!!!!")
		} else {
 			setTimeout("a.run()", 100) 
		}
	}
}*/
/*function Ship(){
	this.x0=374
	this.y0=550
	this.accel=0
	this.speed=0
	this.frot=.8
	this.t0 = new Date().getTime()/1000
	this.move = function (now){
		this.x0 = Math.min(778,Math.max(0, this.x0))
		if (this.x0 > 778 || this.x0 < 0){
			this.accel=0 
			this.speed=0
		}
		dt = now-this.t0
		this.x0 = this.accel*dt*dt/2+this.frot*this.speed*dt+this.x0
		this.speed = this.accel*dt+this.frot*this.speed
		this.t0=now
		document.getElementById("ship").style.left = this.x0 
	}
}*/

/* sh = new Ship() */

/*function keypress(e) {
// 	alert("keypress")
	if (window.event){
		e = window.event
		if (e.keyCode==108){
			sh.accel+=70
		} else if (e.keyCode==106){
			sh.accel-=70
		} else if (e.keyCode==105) {
			var now = new Date().getTime()/1000
			if (nm==0 || now-lastFire>.3){
				lastFire = now
				nm++
				m[nm] = new missile(sh.x0+12,sh.y0,nm)
				m[nm].tire()
			}
		} else if (e.keyCode==113){
			clearTimeout(t)
		} 
	} else {
		if (e.keyCode==39){
			sh.accel+=70
		} else if (e.keyCode==37){
			sh.accel-=70
		} else if (e.keyCode==38) {
			var now = new Date().getTime()/1000
			if (nm==0 || now-lastFire>.3){
				lastFire = now
				nm++
				m[nm] = new missile(sh.x0+12,sh.y0,nm)
				m[nm].tire()
			}
		} else if (e.keyCode==0 && e.charCode==113){
			clearTimeout(t)
		} 
	return true;
	}
}*/

function release(e) {
// 	alert("release")
	if (window.event){
		e = window.event
	if (e.keyCode==74||e.keyCode==76){
		sh.accel=0
}
}
    else {
	if (e.keyCode==39 || e.keyCode==37){
		sh.accel=0
}
	return true;
}
}
</script>
</head>
<body onLoad="redim()" onKeyDown="Touche_presse(event.keyCode)">
	
   <img id="univers" src="img/univers.jpg" style="position:absolute;left:350px;top:200px;width:750px;height:450px;"/>
   <div id="armee"></div>
   <img id="ship" src="img/invader.png" style="position:absolute;left:730px;top:625px;height:15px;width:20px;"/>

 

</body>
 
</html>